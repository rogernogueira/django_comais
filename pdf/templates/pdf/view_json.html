{% extends 'base2.html' %}
{% load static %}

{% block title %}Visualizar {{ filename }} - COMAIS{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">
                        <i class="fas fa-eye me-2"></i>Visualizar: {{ filename }}
                    </h4>
                    <div class="btn-group">
                        <a href="{% url 'pdf:converter_pdf' %}" class="btn btn-light btn-sm">
                            <i class="fas fa-arrow-left me-1"></i>Voltar
                        </a>
                        <a href="{% url 'pdf:download_converted_file' filename %}" class="btn btn-success btn-sm">
                            <i class="fas fa-download me-1"></i>Baixar
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Formato:</strong> JSON | 
                        <strong>Arquivo:</strong> {{ filename }}
                    </div>
                    
                    <!-- Conteúdo JSON -->
                    <div class="json-content p-4 border rounded bg-light" style="max-height: 70vh; overflow-y: auto;">
                        <pre style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.4;">{{ content }}</pre>
                    </div>
                    
                    <!-- Ações -->
                    <div class="mt-3 d-flex justify-content-between">
                        <div>
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                Conteúdo convertido do PDF
                            </small>
                        </div>
                        <div>
                            <a href="{% url 'pdf:download_converted_file' filename %}" class="btn btn-success">
                                <i class="fas fa-download me-2"></i>Baixar Arquivo
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
.json-content pre {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    padding: 20px;
    margin: 0;
}

.json-content .string { color: #d73a49; }
.json-content .number { color: #005cc5; }
.json-content .boolean { color: #6f42c1; }
.json-content .null { color: #6a737d; }
.json-content .key { color: #24292e; font-weight: bold; }

.card-header {
    padding: 1rem 1.25rem;
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Adicionar syntax highlighting básico para JSON
document.addEventListener('DOMContentLoaded', function() {
    const pre = document.querySelector('.json-content pre');
    if (pre) {
        let jsonText = pre.textContent;
        
        // Aplicar syntax highlighting básico
        jsonText = jsonText
            .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?)/g, function(match) {
                let cls = 'string';
                if (/:$/.test(match)) {
                    cls = 'key';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            })
            .replace(/\b(true|false)\b/g, '<span class="boolean">$1</span>')
            .replace(/\b(null)\b/g, '<span class="null">$1</span>')
            .replace(/\b-?\d+(\.\d+)?([eE][+-]?\d+)?\b/g, '<span class="number">$&</span>');
        
        pre.innerHTML = jsonText;
    }
});
</script>
{% endblock %}
